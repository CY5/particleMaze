<!DOCTYPE>
<html>
	<head>
		<style type="text/css">
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
			#map{
				position: absolute;
			    top: 0;
			    right: 0;
			    display: none;
			}
			#details{
			    width: 50%;
			    height: 40%;
			    position: absolute;
			    background: black;
			    opacity: 0.8;
			    margin: 0 20%;
			    display: none;
			    color: white;
			    padding: 5em;
			    font-size: 1em;
			}
			a{
				color: white;
				text-align: center;
			}
		</style>
	</head>
	<body>
		<div id="details">
			<h2>Particle Maze</h2>
			<h4>
				Particle Maze is a randomnly generated Maze (using DFS) from particles. 
				The Maze is solved using Tremaux Algorithms between two node (start & end).
			</h4>
			<div>
				<h4>Technology used:</h4>
				<ul>
					<li>Javascript</li>
					<li>Webgl  (threejs Lib)</li>
				</ul>
			</div>
			<div>
				<a href="index.html">Restart</a>
			</div>
		</div>
		<div id="main"></div>
		<div id="map"></div>
		<script type="text/javascript" src="js/common.js"></script>
		<script type="text/javascript" src="js/algorithms.js"></script>
		<script type="text/javascript" src="js/shapes.js"></script>
		<script type="text/javascript" src="js/solver.js"></script>
		<script type="text/javascript" src="js/threejs_bundle.js"></script>
		<script type="text/javascript">
			var main,
				map,
				camera,
				camera2,
				scene,
				scene2,
				renderer,
				renderer2,
				fps = 60,
				controls,
				stats,
				plight;

			var maxRows =50;
			var maxCols = 50;
			var nodes = 4;
			var vert;
			var vechicle;

			function init(){
				main = document.getElementById( 'main' );
				renderer = new THREE.WebGLRenderer();
				
				renderer.setClearColor( "#001b35" );
				renderer.setSize( window.innerWidth, window.innerHeight );
				main.appendChild( renderer.domElement );
				scene = new THREE.Scene();
				//scene.fog = new THREE.FogExp2( "#001b35", 0.00001 );
				camera = new THREE.PerspectiveCamera( 5, window.innerWidth/window.innerHeight, 0.5, 1000000 );
				
				//controls = new THREE.OrbitControls( camera, renderer.domElement );
				map();
				sky();
				camera.lookAt( scene.position );
				var algo = Algorithms(maxRows, maxCols, 'dfs', 'square');
				var mat = algo.run();

				var p = new Points3D (mat, maxRows, maxCols, nodes, scene);
				var vert = p.drawBoard();
				// lights

				var sol = Solver (maxRows, maxCols, "tremaux", 'square', mat);
				var start = getRandomInt(0,20);
	        	var end = getRandomInt(maxRows,maxRows*maxCols - 1);
	        	console.log(start, end)
	        	var path = sol.run(start, end);
	        	path.push(end);

	        	var shp =  scene.getObjectByName( "starField" );

	        	vechicle = new Vehicle(scene, path.shift(), end, shp, vert);
        		vechicle.run(path);

				var alight = new THREE.AmbientLight( 0x404040 ); // soft white light
				scene.add( alight );

				plight = new THREE.PointLight( 0xff0000, 1, 100 );
				plight.position.set( 50, 50, 50 );
				scene.add( plight );
				
				stats = new Stats();
				main.appendChild( stats.dom );

				window.addEventListener( 'resize', onWindowResize, false );
			}
			function map() {
				main2 = document.getElementById('map');
				renderer2 = new THREE.WebGLRenderer();
				renderer2.setSize( 180, 100 );
				main2.appendChild( renderer2.domElement );
				scene2 = new THREE.Scene();
				// camera
				camera2 = new THREE.CombinedCamera( window.innerWidth / 2, window.innerHeight / 2, 100, 0.5, 1000, 100, 1000 );
				camera2.toOrthographic();

				camera2.toTopView();
				scene2.add( scene );
			}
			function sky(){
			  var skyGeometry = new THREE.Geometry();

			  for ( var i = 0; i < 30000; i ++ ) {

			    var sky = new THREE.Vector3();
			    sky.x = THREE.Math.randFloatSpread( 7000 );
			    sky.y = THREE.Math.randFloatSpread( 5000 );
			    sky.z = THREE.Math.randFloatSpread( 7000 );

			    skyGeometry.vertices.push( sky )

			  }

			  var skyMaterial = new THREE.PointsMaterial( { color: 0x888888 } )

			  var skyField = new THREE.Points( skyGeometry, skyMaterial );
			  skyField.name="sky";
			  skyField.position.copy(new THREE.Vector3(2000,700,2400));
			  scene.add( skyField );
			}
			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}
			function render(cb){
			    setTimeout(function(){
			        requestAnimationFrame(cb);
			    }, 1000 / fps);
			}
			function animate() {
				vechicle.anim();
				camera.lookAt( vechicle.vech.position );
				
				camera2.position.copy(camera.position);
				camera2.position.setLength( 400 );

				//controls.update();
				stats.update();

				renderer.render(scene, camera);
				renderer2.render( scene2, camera2 );
			    camera2.lookAt( scene2.position );
			    render(animate);

			};
			function end(){
				var det = document.getElementById("details");
				det.style.display = "block";
			}
		init();
		render(animate);	
		</script>
	</body>
</html>